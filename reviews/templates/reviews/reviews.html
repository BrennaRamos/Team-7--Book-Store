{% extends 'base.html' %}
{% block content %}

<script type="text/javascript">
    function resizeImage(id) {
        var img = document.getElementById(id);
        if(img.style.height ==="100%") {
            img.style.height = "170px";
            img.style.width = "100px";
        } else {
            img.style.height = "100%";
            img.style.width = "100%";
        }
    }
</script>

<div class="review-wrap">
	<h1> {{ book_title }}</h1>

	<img id="1" src="{{ book_photo.url }}" width=100 height=170 onclick="resizeImage(1)">
	<p></p>
	<blockquote class="blockquote" style="background-color:#f2f2f2;border-radius: 15px;padding:2px;">
		<h5> {{ book_genre }} </h5>
		<p> {{ book_desc }} </p>
		<h6> Published by {{ book_publisher }} on {{ book_pubdate }} </h6>
	</blockquote>
	<blockquote class="blockquote" style="background-color:#f2f2f2;border-radius: 15px;padding:2px;">
		<h5> {{ book_author }} </h5>
		<p> {{ book_authordesc }} </p>

	</blockquote>
</div>

<div class="review-wrap">
	<h1>Reviews for {{ book_title }}!</h1>
	<div>
		{% if messages %}
			<ul classs="messages">
				{% for message in messages %}
				<li>
					<div class="alert alert-{{message.tags}}"> {{ message }} </div>
				</li>
				{% endfor %}
			</ul>
		{% endif %}
	</div>
	{% if user.is_authenticated %}
		{% if purchased %}
			{% if reviewed_already %}
			{% else %}
				{% if reviews.count == 0 %}
					<p>Be the first to review this book!</p>
				{% elif this_user_review|length == 0 %}
					<p>Create a review!</p>
				{% endif %}

				<form method="post" class="review-form-group">
					<p>Write a review no more than 800 characters long.</p>
					{% csrf_token %}
					{{ review_form.as_p}}
					<input type="submit" value="Review" class="btn btn-outline-success" id="review-btn">
				</form>
			{% endif %}
		{% else %}
			<li>
				<div class="alert alert-warning"> You must purchase this book in order to review it. </div>
			</li>
		{% endif %}
	{% else %}
		<li>
			<div class="alert alert-warning"> Your must be logged-in to review a book. </div>
		</li>
	{% endif %}

	<div class="main-content-section">
		{% if average_rating %}
			<p class="ave-rating">Average Rating: {{ average_rating|floatformat:2 }}</p>
		{% endif %}

		<h2>{{ reviews.count }} Review{{ reviews|pluralize }}</h2>
		{% if this_user_review %}
			<h3 style="background-color:#e6ffe6; border-radius:15px;padding:2px;">Your review:<h3>
			{% for review in this_user_review %}
				<blockquote class="blockquote" style="background-color:#f2f2f2;border-radius: 15px;padding:2px;">
					<cite title="Source Title">
						<img class="rounded-circle account-img" src="{{ review.author.profile.profilePic.url }}" width="50" height="50">
								{{ review.author|capfirst }} | {{ review.date_posted }}</cite>
								<a href="{% url 'updateReview' review.id %}">Update</a>
								<a href="{% url 'deleteReview' review.id %}">Delete</a>
						<p class="mb-0"><span class="rating">Rating:</span> {{ review.rating }} Star(s)</p>
						<p class="mb-0">{{ review.content }}</p>
				</blockquote>
			{% endfor %}
		{% endif %}
		{% if this_user_review and reviews_minus_this_user.count > 0 %}
			<h3 style="background-color:#e6ffe6; border-radius:15px;padding:2px;">Other's reviews:</h3>
		{% endif %}

		{% for review in reviews_minus_this_user %}
			<blockquote class="blockquote" style="background-color:#f2f2f2;border-radius: 15px;padding:2px;">
				<cite title="Source Title">
					{% if review.anonymous %}
					<img class="rounded-circle account-img" src="/static/images/anon.png" width="50" height="50">
						Anonymous
					{% else %}
						{% if review.author.profile.profilePic.url %}
							<img class="rounded-circle account-img" src="{{ review.author.profile.profilePic.url }}" width="50" height="50">
						{% else %}
							<img class="rounded-circle account-img" src="/static/images/anon.png" width="50" height="50">
						{% endif %}
						{{ review.author|capfirst }}
					{% endif %}
					 | {{ review.date_posted }}</cite>
				<p class="mb-0"><span class="rating">Rating:</span> {{ review.rating }} Star(s)</p>
				<p class="mb-0">{{ review.content }}</p>
			</blockquote>
    	{% endfor %}
    </div>
</div>
{% endblock content %}